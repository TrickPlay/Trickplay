module storage;

[[
#include "storage.h"
]]

class LocalHash [[Storage::LocalHash*]]
{
	LocalHash(string name="DEFAULT_DB")
		[[
				*self = new Storage::LocalHash();
            if (lua_gettop(L)==2 && lua_istable(L,-2))
            {
                lua_pushvalue(L,-2);
                lb_set_props_from_table(L);
                lua_pop(L,1);
            }
				else
				{
					(*self)->name = name;
				}

				(*self)->connect();
		]];

	~LocalHash()
		[[
			delete self;
		]];

	readonly int count
		[[
			count = self->count();
		]];

	table get(string key)
		[[
			Storage::String theKey = key;
			Storage::String value = self->get(theKey);
			lua_pushlstring(L, value.data(), value.length());
		]];

	put(string key, string value)
		[[
			Storage::String theKey = key;
			Storage::String theValue = value;
			self->put(theKey, theValue);
		]];

	del(string key)
		[[
			Storage::String theKey = key;
			self->del(theKey);
		]];

	nuke()
		[[
			self->nuke();
		]];

	begin()
		[[
			self->begin();
		]];

	commit()
		[[
			self->commit();
		]];

	abort()
		[[
			self->abort();
		]];

	flush()
		[[
			self->flush();
		]];
}
